<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Map â€” Accessible + Themed (CSS-in-JS)</title>
  <script>
  // ===== CSS-in-JS: injected at runtime =====
  const CSS = `
  :root{
    --bg:#0b0d14; --fg:#e7ebf0; --muted:#9aa4b2; --line:#1f2633; --card:#0f1420; --acc:#60a5fa;
    /* Category palettes (base/hover/active) chosen for >= 4.5:1 contrast on #0f1420 */
    --ml:#3b82f6; --ml-h:#60a5fa; --ml-a:#93c5fd;
    --dl:#ef4444; --dl-h:#f87171; --dl-a:#fca5a5;
    --apps:#22c55e; --apps-h:#4ade80; --apps-a:#86efac;
    --models:#eab308; --models-h:#facc15; --models-a:#fde047;
    --root:#a78bfa; --root-h:#c4b5fd; --root-a:#ddd6fe;
    --other:#94a3b8; --other-h:#a8b2c4; --other-a:#c2cbd8;
    --focus:#ffffff; --focus-bg:rgba(255,255,255,.06);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,'Noto Sans KR',sans-serif}
  a{color:var(--acc);text-decoration:none}

  header{position:sticky;top:0;z-index:10;background:rgba(11,13,20,.7);backdrop-filter:saturate(160%) blur(10px);border-bottom:1px solid var(--line)}
  .bar{max-width:1100px;margin:auto;display:flex;gap:10px;align-items:center;padding:12px 14px}
  .brand{font-weight:900;letter-spacing:.2px}
  .sp{flex:1}
  .btn{background:#0f172a;color:var(--fg);border:1px solid var(--line);border-radius:10px;padding:7px 10px;font-size:13px;cursor:pointer;transition:transform .08s ease}
  .btn:hover{background:#111a2e;transform:translateY(-1px)}
  .input{background:#0f172a;color:var(--fg);border:1px solid var(--line);border-radius:10px;padding:8px 10px;font-size:13px;min-width:220px}
  .input:focus{outline:2px solid var(--focus); outline-offset:2px; background:var(--focus-bg)}
  .visually-hidden{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

  main{max-width:1100px;margin:14px auto;padding:0 14px;display:grid;grid-template-columns: 1fr min(38%, 400px);gap:14px}
  .tree{border:1px solid var(--line);border-radius:12px;background:var(--card);padding:10px 10px;min-height:70vh;overflow:auto}
  .panel{border:1px solid var(--line);border-radius:12px;background:var(--card);padding:12px;min-height:70vh;}
  .panel h2{margin:0 0 6px;font-size:16px;font-weight:900}
  .panel h3{margin:14px 0 6px;font-size:13px}
  .panel .chips{display:flex;gap:6px;flex-wrap:wrap}
  .chip{font-size:11px;color:#cbd5e1;border:1px solid var(--line);padding:2px 8px;border-radius:999px}
  .metaRow{display:grid;grid-template-columns: 1fr 1fr;gap:8px;margin-top:8px}
  .meter{height:8px;border-radius:999px;background:#0b1424;border:1px solid #283247;overflow:hidden}
  .meter>i{display:block;height:100%;background:var(--acc);transition:transform .25s ease;transform-origin:left center}

  /* Tree */
  .node{position:relative; padding-left:22px; margin:4px 0}
  .node .row{display:flex;gap:8px;align-items:center;line-height:1.2}
  .chev{position:absolute;left:2px;top:2px;width:16px;height:16px;display:grid;place-items:center;font-size:11px;color:#9fb1c7;cursor:pointer;user-select:none;transition:transform .18s ease;will-change:transform}
  .chev.hidden{visibility:hidden}
  .label{cursor:pointer;display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border-radius:12px;border:1px solid var(--line);transition:border-color .2s ease, box-shadow .2s ease, background .2s ease, transform .08s ease; will-change:transform}
  .label .icon{width:18px;text-align:center;opacity:.95}
  .label .txt{white-space:nowrap; font-weight:700}
  .label .badge{font-size:10px;border:1px solid var(--line);padding:1px 6px;border-radius:999px;letter-spacing:.3px}
  .children{border-left:1px dashed #243045; margin-left:8px; padding-left:12px; overflow:hidden; transition:max-height .25s ease, opacity .2s ease, transform .25s ease; will-change:transform,opacity}
  .children.collapsing{will-change:max-height,opacity,transform}

  /* Category theme application (label states + panel theme line) */
  [data-cat="Root"] .label{border-color:var(--root)}
  [data-cat="Root"] .label:hover{border-color:var(--root-h); background:rgba(167,139,250,.08)}
  [data-cat="Root"] .label.active{border-color:var(--root-a); box-shadow:0 0 0 2px rgba(167,139,250,.35)}

  [data-cat="ML"] .label{border-color:var(--ml)}
  [data-cat="ML"] .label:hover{border-color:var(--ml-h); background:rgba(59,130,246,.08)}
  [data-cat="ML"] .label.active{border-color:var(--ml-a); box-shadow:0 0 0 2px rgba(59,130,246,.35)}

  [data-cat="DL"] .label{border-color:var(--dl)}
  [data-cat="DL"] .label:hover{border-color:var(--dl-h); background:rgba(239,68,68,.08)}
  [data-cat="DL"] .label.active{border-color:var(--dl-a); box-shadow:0 0 0 2px rgba(239,68,68,.35)}

  [data-cat="Apps"] .label{border-color:var(--apps)}
  [data-cat="Apps"] .label:hover{border-color:var(--apps-h); background:rgba(34,197,94,.08)}
  [data-cat="Apps"] .label.active{border-color:var(--apps-a); box-shadow:0 0 0 2px rgba(34,197,94,.35)}

  [data-cat="Models"] .label{border-color:var(--models)}
  [data-cat="Models"] .label:hover{border-color:var(--models-h); background:rgba(234,179,8,.10)}
  [data-cat="Models"] .label.active{border-color:var(--models-a); box-shadow:0 0 0 2px rgba(234,179,8,.35)}

  [data-cat="Other"] .label{border-color:var(--other)}
  [data-cat="Other"] .label:hover{border-color:var(--other-h); background:rgba(148,163,184,.10)}
  [data-cat="Other"] .label.active{border-color:var(--other-a); box-shadow:0 0 0 2px rgba(148,163,184,.35)}

  /* Focus ring for WCAG */
  .focusable:focus{outline:2px solid var(--focus); outline-offset:2px; background:var(--focus-bg)}

  /* Search & status */
  .node.match > .row .label{box-shadow:0 0 0 2px rgba(96,165,250,.35)}
  .node.dim{opacity:.40}
  .hint{color:#9fb1c7;font-size:12px;margin-top:6px}
  .empty{color:var(--muted);font-size:14px;border:1px dashed #2a3447;border-radius:10px;padding:10px;text-align:center;margin-top:8px}

  .examples{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:10px}
  .excard{border:1px solid var(--line);border-radius:10px;overflow:hidden;background:#0e1626}
  .excard img{display:block;width:100%;height:110px;object-fit:cover}
  .excard .cap{padding:6px 8px;font-size:12px;color:#cdd6e3}
  @media (max-width:720px){ .examples{grid-template-columns:1fr} }

  /* Tooltip preview */
  #tooltip{position:fixed;z-index:50;pointer-events:none;opacity:0;transform:translateY(6px);transition:opacity .12s ease, transform .12s ease;will-change:transform,opacity}
  #tooltip .card{min-width:220px;max-width:360px;background:#0b1220;border:1px solid #22304a;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:8px}
  #tooltip .title{font-size:12px;font-weight:800;margin-bottom:4px}
  #tooltip .desc{font-size:12px;color:#cbd5e1}

  /* Loading spinner */
  #loading{position:fixed;right:16px;bottom:16px;display:none;gap:8px;align-items:center;background:#0b1220;border:1px solid #22304a;color:#e5e7eb;border-radius:10px;padding:8px 10px}
  #loading .dot{width:7px;height:7px;border-radius:999px;background:#60a5fa;animation:b 1s infinite alternate}
  #loading .dot:nth-child(2){animation-delay:.2s}
  #loading .dot:nth-child(3){animation-delay:.4s}
  @keyframes b{to{transform:translateY(-3px);opacity:.6}}
  `;
  const styleEl = document.createElement('style');
  styleEl.id = 'aimap-styles';
  styleEl.textContent = CSS;
  document.head.appendChild(styleEl);
  </script>
</head>
<body>
  <header>
    <div class="bar">
      <div class="brand">AI Map</div>
      <input id="q" class="input focusable" placeholder="ê²€ìƒ‰ (ì˜ˆ: GPT, ì§€ë„ í•™ìŠµ, Image)" aria-label="ë…¸ë“œ ê²€ìƒ‰" />
      <button id="clear" class="btn focusable" aria-label="ê²€ìƒ‰ ì´ˆê¸°í™”">Clear</button>
      <div class="sp"></div>
      <button id="expandAll" class="btn focusable" aria-label="ëª¨ë‘ í¼ì¹˜ê¸°">Expand all</button>
      <button id="collapseAll" class="btn focusable" aria-label="ëª¨ë‘ ì ‘ê¸°">Collapse all</button>
      <button id="toggleLang" class="btn focusable" aria-pressed="false" aria-label="ì–¸ì–´ ì „í™˜">KR / EN</button>
    </div>
  </header>

  <main>
    <section id="tree" class="tree" role="tree" aria-label="AI ê°œë… íŠ¸ë¦¬"></section>
    <aside id="panel" class="panel" aria-live="polite" aria-label="ì„ íƒ ë…¸ë“œ ìƒì„¸">
      <h2>ë…¸ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
      <p class="muted">ì¢Œì¸¡ íŠ¸ë¦¬ì—ì„œ í•­ëª©ì„ í´ë¦­í•˜ë©´ ì—¬ê¸° ìš”ì•½ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
      <div class="hint">í‚¤ë³´ë“œ: â†‘/â†“ ì´ë™ Â· â†’ í¼ì¹˜ê¸° Â· â† ì ‘ê¸°/ìƒìœ„ Â· Enter ì„ íƒ Â· Esc ê²€ìƒ‰ ì´ˆê¸°í™”</div>
    </aside>
  </main>

  <div id="tooltip" role="tooltip" aria-hidden="true"><div class="card"><div class="title"></div><div class="desc"></div></div></div>
  <div id="loading" aria-live="polite"><div class="dot"></div><div class="dot"></div><div class="dot"></div><span style="font-size:12px">Loadingâ€¦</span></div>
  <div id="sr-live" class="visually-hidden" aria-live="polite"></div>

<script>
// ===== Data =====
const data = {
  name: "Artificial Intelligence (ì¸ê³µì§€ëŠ¥)",
  info: "ì‚¬ëŒì²˜ëŸ¼ í•™ìŠµí•˜ê³  ì¶”ë¡ í•˜ëŠ” ì»´í“¨í„° ê¸°ìˆ ",
  children: [
    { name: "Machine Learning (ê¸°ê³„ í•™ìŠµ)", info: "ë°ì´í„°ë¥¼ ì´ìš©í•´ ìŠ¤ìŠ¤ë¡œ ë°°ìš°ëŠ” ê¸°ìˆ ", children: [
      { name: "Supervised Learning (ì§€ë„ í•™ìŠµ)", info: "ì •ë‹µì„ ì•Œë ¤ì£¼ê³  ë°°ìš°ëŠ” ë°©ì‹ (ì˜ˆ: ìŠ¤íŒ¸ë©”ì¼ ë¶„ë¥˜)" },
      { name: "Unsupervised Learning (ë¹„ì§€ë„ í•™ìŠµ)", info: "ì •ë‹µ ì—†ì´ íŒ¨í„´ì„ ì°¾ëŠ” ë°©ì‹ (ì˜ˆ: ê³ ê° ê·¸ë£¹ ë‚˜ëˆ„ê¸°)" },
      { name: "Reinforcement Learning (ê°•í™” í•™ìŠµ)", info: "ë³´ìƒì„ í†µí•´ ë°°ìš°ëŠ” ë°©ì‹ (ì˜ˆ: ê²Œì„ AI)" }
    ]},
    { name: "Deep Learning (ë”¥ëŸ¬ë‹)", info: "ì‹ ê²½ë§ êµ¬ì¡°ë¥¼ ëª¨ë°©í•œ í•™ìŠµ ë°©ë²•", children: [
      { name: "CNN (ì˜ìƒ)", info: "ì‚¬ì§„/ì˜ìƒ ì¸ì‹ (ì˜ˆ: ê³ ì–‘ì´ ì‚¬ì§„ ë§íˆê¸°)" },
      { name: "RNN / LSTM (ì‹œí€€ìŠ¤)", info: "ë¬¸ì¥/ì†Œë¦¬ ì²˜ë¦¬ (ì˜ˆ: ë²ˆì—­, ìŒì„± ì¸ì‹)" },
      { name: "GAN (ìƒì„±)", info: "ìƒˆë¡œìš´ ë°ì´í„° ìƒì„± (ì˜ˆ: ê°€ì§œ ì‚¬ì§„, ì´ë¯¸ì§€ ìƒì„±)" }
    ]},
    { name: "Applications (ì‘ìš© ë¶„ì•¼)", info: "ìš°ë¦¬ê°€ ì²´í—˜í•˜ëŠ” AIì˜ ê²°ê³¼", children: [
      { name: "ğŸ“· Image Generation (ë¬¸ì â†’ ì‚¬ì§„)", info: "í…ìŠ¤íŠ¸ë¡œ ì´ë¯¸ì§€ë¥¼ ìƒì„±", children: [
        { name: "MidJourney", info: "ëŒ€í‘œì ì¸ ì´ë¯¸ì§€ ìƒì„± AI" },
        { name: "Adobe Firefly", info: "ì–´ë„ë¹„ì˜ ì´ë¯¸ì§€ ìƒì„± AI" }
      ]},
      { name: "ğŸ¥ Video Generation (ë¬¸ì¥ â†’ ì˜ìƒ)", info: "ì„¤ëª…ë§Œìœ¼ë¡œ ì˜ìƒ ì œì‘", children: [
        { name: "Runway", info: "ì˜ìƒ ìƒì„± ë° í¸ì§‘ AI" },
        { name: "OpenAI Sora", info: "ë¬¸ì¥ìœ¼ë¡œ ì˜ìƒì„ ë§Œë“œëŠ” AI" }
      ]},
      { name: "ğŸµ Music Generation (í”„ë¡¬í”„íŠ¸ â†’ ìŒì•…)", info: "í”„ë¡¬í”„íŠ¸ë¡œ ìŒì•… ìƒì„±", children: [
        { name: "Suno", info: "ë…¸ë˜/ìŒì•… ìƒì„± AI" },
        { name: "AIVA", info: "ì‘ê³¡ íŠ¹í™” AI" }
      ]},
      { name: "ğŸ’¬ Chatbot (ëŒ€í™”í˜• AI)", info: "ì‚¬ëŒì²˜ëŸ¼ ëŒ€í™”í•˜ëŠ” AI", children: [
        { name: "ChatGPT", info: "OpenAIì˜ ëŒ€í‘œ ì±—ë´‡" },
        { name: "Claude", info: "Anthropicì˜ ëŒ€í™”í˜• AI" }
      ]}
    ]},
    { name: "ğŸŒ Major AI Models (ëŒ€í‘œ AI ëª¨ë¸)", info: "í˜„ì¬ ë„ë¦¬ ì“°ì´ëŠ” ëŒ€í‘œ ëª¨ë¸ë“¤", children: [
      { name: "GPT-4 (ê³ ì„±ëŠ¥ ë©€í‹°ëª¨ë‹¬Â·ì¶”ë¡  | Best-in-class multimodal reasoning)", details: {
          features:["KR: í…ìŠ¤íŠ¸Â·ì´ë¯¸ì§€ ì…ë ¥, ê¸´ ë¬¸ë§¥, ì½”ë“œ í•´ì„ | EN: Text+image input, long context, code reasoning","KR: ë„êµ¬ í˜¸ì¶œ(ê²€ìƒ‰/í•¨ìˆ˜/ì½”ë“œ ì‹¤í–‰) | EN: Tool calling (search/functions/runtime)"],
          pros:["KR: ë³µì¡í•œ ê³¼ì œ(ê¸°íšÂ·ìš”ì•½Â·ë¶„ì„Â·ì½”ë”©)ì— ê°•í•¨ | EN: Strong for complex planning/analysis/coding","KR: ê²°ê³¼ ì¼ê´€ì„±ê³¼ ì•ˆì „ì¥ì¹˜ ì„±ìˆ™ | EN: Consistent outputs; mature safeguards"],
          cons:["KR: ê³ ê¸‰ ê¸°ëŠ¥ì€ ìœ ë£Œ, ì§€ì—° ê°€ëŠ¥ | EN: Paid tiers; occasional latency","KR: ìµœì‹ ì„±ì€ ê²€ìƒ‰/RAG ì—°ë™ í•„ìš” | EN: Needs retrieval for freshness"],
          uses:["KR: ë³´ê³ ì„œ/ì½”ë“œ ë¦¬ë·°/ë°ì´í„° í•´ì„¤ | EN: Reports, code review, data commentary"],
          prompt:"KR: ì´ ìš”êµ¬ì‚¬í•­ìœ¼ë¡œ REST API ì„¤ê³„ ì´ˆì•ˆê³¼ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì œì‹œí•´ì¤˜. | EN: Draft a REST API design and test cases for these requirements.",
          metrics:{popularity:0.95, maturity:0.9}
      }},
      { name: "Gemini (êµ¬ê¸€ ìƒíƒœê³„ ì—°ë™ ìµœì  | Deep Google ecosystem integration)", details: {
          features:["KR: ë©€í‹°ëª¨ë‹¬; ê²€ìƒ‰/Workspace ì—°ë™ | EN: Multimodal; Search/Workspace hooks","KR: ëª¨ë°”ì¼~í´ë¼ìš°ë“œ ìŠ¤ì¼€ì¼ | EN: Scales from mobile to cloud"],
          pros:["KR: Docs/Sheets/Drive/YouTube ì›Œí¬í”Œë¡œìš° | EN: Smooth Docs/Sheets/Drive/YouTube flows","KR: ë¹ ë¥¸ ì •ë³´ íƒìƒ‰Â·ìš”ì•½ | EN: Fast discovery/summarization"],
          cons:["KR: ì§€ì—­/ì œí’ˆë³„ ê¸°ëŠ¥ ì°¨ì´ | EN: Region/product variance","KR: íŠ¹ìˆ˜ ë„ë©”ì¸ì—” íŠœë‹Â·RAG í•„ìš” | EN: Needs RAG/tuning for niche domains"],
          uses:["KR: ë¬¸ì„œ ìë™í™”, ìë£Œ ì¡°ì‚¬, êµìœ¡ ì½˜í…íŠ¸ | EN: Doc automation, research, edu content"],
          prompt:"KR: ì´ 3ê°œ ë…¼ë¬¸ì˜ ê³µí†µ ì£¼ì œì™€ ì°¨ì´ë¥¼ í‘œë¡œ ìš”ì•½í•´ì¤˜. | EN: Summarize common themes and differences of these three papers in a table.",
          metrics:{popularity:0.85, maturity:0.8}
      }},
      { name: "Llama (ì˜¤í”ˆÂ·íŠœë‹ ììœ ë„ | Open model with flexible fine-tuning)", details: {
          features:["KR: ì†Œí˜•~ëŒ€í˜• íŒŒë¼ë¯¸í„°; ë¡œì»¬/ì˜¨í”„ë ˆë¯¸ìŠ¤ | EN: Sizes smallâ†’large; on-prem/local","KR: ì»¤ë®¤ë‹ˆí‹° ìƒíƒœê³„(LoRA/ì–´ëŒ‘í„°/RAG) | EN: Rich community (LoRA/adapters/RAG)"],
          pros:["KR: ë¹„ìš©Â·í”„ë¼ì´ë²„ì‹œ í†µì œ, ì»¤ìŠ¤í„°ë§ˆì´ì§• ìš©ì´ | EN: Cost/privacy control; customization","KR: ê²½ëŸ‰ ëª¨ë¸ì€ ì˜¨ë””ë°”ì´ìŠ¤ ê°€ëŠ¥ | EN: Smaller variants run on edge"],
          cons:["KR: ìµœì²¨ë‹¨ ëŒ€ë¹„ ì¶”ë¡ /ì–¸ì–´ í¸ì°¨ | EN: May trail SOTA on reasoning/language","KR: ë°°í¬/ì•ˆì „ì„± ì§ì ‘ ì±…ì„ | EN: You own deployment & safety"],
          uses:["KR: ì‚¬ë‚´ ë¹„ì„œ, ì „ìš© ë„ë©”ì¸ Q&A, ì˜¤í”„ë¼ì¸ | EN: Private assistant, domain Q&A, offline"],
          prompt:"KR: ì‚¬ë‚´ ì •ì±… PDFë¥¼ ë°”íƒ•ìœ¼ë¡œ íœ´ê°€ FAQë¥¼ ìƒì„±í•´ì¤˜. | EN: Generate vacation FAQs from our internal policy PDF.",
          metrics:{popularity:0.8, maturity:0.75}
      }},
      { name: "Claude (ì•ˆì „ì„± ì¤‘ì‹¬Â·ê¸´ ë¬¸ë§¥ | Safety-first with long context)", details: {
          features:["KR: ê¸´ ë¬¸ì„œ ì²˜ë¦¬Â·ì •í™• ìš”ì•½, í—Œë²•ì  AI | EN: Long-context summarization; constitutional AI","KR: ì„¬ì„¸í•œ ì§€ì¹¨ ì¤€ìˆ˜Â·í†¤ ì œì–´ | EN: Careful instruction-following; tone control"],
          pros:["KR: ì¥ë¬¸ ê¸°íšÂ·ê³„ì•½ì„œ ê²€í† ì— ì•ˆì •ì  | EN: Stable for long planning & reviews","KR: ë³´ìˆ˜ì  ê°€ë“œë ˆì¼ | EN: Conservative safeguards"],
          cons:["KR: í¬ë¦¬ì—ì´í‹°ë¸Œ/ì½”ë“œ í¸ì°¨ | EN: Creative/code variance by version","KR: ë¹„ìš©/ì¿¼í„° í™•ì¸ í•„ìš” | EN: Check pricing/quotas"],
          uses:["KR: ê·œì • ì¤€ìˆ˜ ë¬¸ì„œ, ì •ì±… ìš”ì•½, ë¦¬ìŠ¤í¬ ì½”ë©˜íŠ¸ | EN: Compliance docs, risk comments"],
          prompt:"KR: ê³„ì•½ì„œ í•µì‹¬ ë¦¬ìŠ¤í¬ë¥¼ í‘œë¡œ ì •ë¦¬í•˜ê³  ê·¼ê±° ì¡°í•­ì„ ì¸ìš©í•´ì¤˜. | EN: Tabulate key risks and cite clauses.",
          metrics:{popularity:0.88, maturity:0.82}
      }},
      { name: "Stable Diffusion (í…ìŠ¤íŠ¸â†’ì´ë¯¸ì§€Â·ë¡œì»¬ | Text-to-image; local & customizable)", details: {
          features:["KR: ì˜¤í”ˆ ê°€ì¤‘ì¹˜; ControlNet/LoRA | EN: Open weights; ControlNet/LoRA","KR: ìŠ¤íƒ€ì¼ ì „í™˜Â·í¸ì§‘(in/out-painting) | EN: Style transfer; in/out-painting"],
          pros:["KR: ë¹„ìš© ì ˆê°Â·ì†ë„/í”„ë¼ì´ë²„ì‹œ í†µì œ | EN: Cost/privacy control; speed","KR: ì»¤ìŠ¤í…€ ì²´í¬í¬ì¸íŠ¸ë¡œ ìŠ¤íƒ€ì¼ ì¼ê´€ | EN: Consistent style via checkpoints"],
          cons:["KR: íŒŒë¼ë¯¸í„° íŠœë‹ ë‚œì´ë„ | EN: Prompt/params tuning complexity","KR: ì €ì‘ê¶Œ/ì´ˆìƒê¶Œ ì´ìŠˆ ì£¼ì˜ | EN: Copyright/persona risks"],
          uses:["KR: ì½˜ì…‰íŠ¸ ì•„íŠ¸, ë§ˆì¼€íŒ… ì‹œì•ˆ, ëª©ì—… | EN: Concept art, marketing comps, mockups"],
          prompt:"KR: cinematic, soft lighting, 35mm, modern minimal desk setup, high detail",
          metrics:{popularity:0.83, maturity:0.78}
      }},
      { name: "Copilot (ì—…ë¬´ í†µí•©Â·ìƒì‚°ì„± | Productivity across M365/Windows)", details: {
          features:["KR: Word/Excel/PowerPoint/Outlook/Teams í†µí•© | EN: Deep integration with M365 apps","KR: ì—”í„°í”„ë¼ì´ì¦ˆ ë³´ì•ˆÂ·ê°ì‚¬ | EN: Enterprise security & governance"],
          pros:["KR: íšŒì˜ ìš”ì•½Â·ë©”ì¼ ì´ˆì•ˆÂ·ìŠ¬ë¼ì´ë“œ ì‘ì„± | EN: Meetings, emails, slidesâ€”faster","KR: ê¶Œí•œ ê¸°ë°˜ ë°ì´í„° ì ‘ê·¼ | EN: RBAC & tenant-scoped access"],
          cons:["KR: ë°ì´í„° í’ˆì§ˆÂ·ê¶Œí•œ ì˜ì¡´ | EN: Dependent on data quality/permissions","KR: ì‚¬ëŒ ê²€í† /ìŠ¹ì¸ í•„ìš” | EN: Requires human review/approval"],
          uses:["KR: ë¶„ê¸° ë³´ê³ ì„œ ì´ˆì•ˆÂ·ìˆ«ì í•´ì„¤Â·ì•¡ì…˜ ì¶”ì¶œ | EN: Draft reports, explain numbers, actions"],
          prompt:"KR: ì§€ë‚œ ë¶„ê¸° ë§¤ì¶œ ì—‘ì…€ì„ ìš”ì•½í•˜ê³  ì´ìŠˆ 3ê°€ì§€ë¥¼ ìŠ¬ë¼ì´ë“œë¡œ ë§Œë“¤ì–´ì¤˜. | EN: Summarize last quarterâ€™s Excel and create 3-slide highlights.",
          metrics:{popularity:0.86, maturity:0.84}
      }}
    ]}
  ]
};

// ===== Helpers & Accessibility =====
let lang = 'ko';
const srLive = document.getElementById('sr-live');
function announce(msg){ srLive.textContent=''; setTimeout(()=> srLive.textContent=msg, 10); }

function displayName(raw){
  const m = raw.match(/^(.*?)(?:\s*\((.*?)\))?$/); if (!m) return raw;
  const left=m[1].trim(); const inside=(m[2]||'').trim(); const hasKo=/[\u3131-\uD79D]/.test(inside);
  return (lang==='ko') ? (hasKo? inside : raw) : left;
}

function buildModel(d, parent=null){
  const node = { name:d.name, info:d.info, details:d.details||null, metrics:d.details?.metrics||null, children:[], parentRef:parent, el:null, labelEl:null, childrenEl:null, expanded:false };
  node.children=(d.children||[]).map(c=>buildModel(c,node));
  return node;
}
const model = buildModel(data); model.expanded=true;

const treeEl = document.getElementById('tree');
const panelEl = document.getElementById('panel');
const tooltip = document.getElementById('tooltip');
const tooltipTitle = tooltip.querySelector('.title');
const tooltipDesc = tooltip.querySelector('.desc');
const loadingEl = document.getElementById('loading');
let current = null; let focusNode = null;

// Ensure ARIA role on container (harden for sandboxed environments)
if (treeEl.getAttribute('role') !== 'tree') treeEl.setAttribute('role','tree');

function topOfRoot(node){ let cur=node; while(cur && cur.parentRef && cur.parentRef!==model) cur=cur.parentRef; return cur; }
function categoryOf(node){
  if (node===model) return 'Root';
  const top = node.parentRef? topOfRoot(node) : node; const n = top && top.name || '';
  if (n.includes('Machine Learning')) return 'ML';
  if (n.includes('Deep Learning')) return 'DL';
  if (n.includes('Applications')) return 'Apps';
  if (n.includes('Major AI Models')) return 'Models';
  if (node.name.includes('Artificial Intelligence')) return 'Root';
  return 'Other';
}
function iconFor(node){
  const nm=node.name;
  if (/ğŸ“·|Image Generation/.test(nm)) return 'ğŸ“·';
  if (/ğŸ¥|Video Generation/.test(nm)) return 'ğŸ¥';
  if (/ğŸµ|Music Generation/.test(nm)) return 'ğŸµ';
  if (/ğŸ’¬|Chatbot/.test(nm)) return 'ğŸ’¬';
  const cat=categoryOf(node);
  if (cat==='Root') return 'ğŸ¤–'; if (cat==='ML') return 'ğŸ§ '; if (cat==='DL') return 'ğŸ§¬'; if (cat==='Apps') return 'ğŸš€'; if (cat==='Models') return 'ğŸŒ'; return 'ğŸ“Œ';
}

// Real example images for DL
function dlExamplesFor(node){
  const nm=node.name;
  if (nm.includes('CNN')) return [{src:'https://upload.wikimedia.org/wikipedia/commons/d/d2/Kitten_5.jpg',cap:"ì‹¤ì œ ì‚¬ì§„ â€” ë¶„ë¥˜/íƒì§€ (Wikimedia CC0)"}];
  if (nm.includes('RNN')||nm.includes('LSTM')) return [{src:'https://upload.wikimedia.org/wikipedia/commons/d/dd/Muybridge_race_horse_animated.gif',cap:'ì—°ì† í”„ë ˆì„(ì‹œí€€ìŠ¤) â€” ë¬´ì´ë¸Œë¦¬ì§€ (PD)'}];
  if (nm.includes('GAN')) return [{src:'https://upload.wikimedia.org/wikipedia/commons/1/1f/Woman_1.jpg',cap:'í•©ì„± ì¸ë¬¼ ì˜ˆì‹œ (PD)'}];
  return [];
}

// Render tree
function renderNode(node){
  const hasKids=node.children && node.children.length>0; const cat=categoryOf(node);
  const wrap=document.createElement('div'); wrap.className='node'; wrap.dataset.cat=cat; wrap.setAttribute('role','none');

  const row=document.createElement('div'); row.className='row'; wrap.appendChild(row);

  const chev=document.createElement('button'); chev.type='button'; chev.className='chev focusable'; chev.setAttribute('aria-label', (node.expanded?'ì ‘ê¸°: ':'í¼ì¹˜ê¸°: ')+displayName(node.name)); chev.setAttribute('tabindex','-1');
  if(!hasKids){chev.classList.add('hidden'); chev.setAttribute('aria-hidden','true');}
  chev.textContent=node.expanded?'â–¾':'â–¸';
  row.appendChild(chev);

  const label=document.createElement('div'); label.className='label focusable'; label.setAttribute('role','treeitem'); label.setAttribute('aria-selected', 'false'); label.setAttribute('tabindex','-1');
  // Ensure aria-expanded is present immediately for tests (updated again after layout)
  label.setAttribute('aria-expanded', String(!!node.expanded));
  label.innerHTML=`<span class="icon">${iconFor(node)}</span><span class="txt">${displayName(node.name)}</span><span class="badge">${cat}</span>`;
  row.appendChild(label);

  const kidsWrap=document.createElement('div'); kidsWrap.className='children'; kidsWrap.setAttribute('role','group');
  wrap.appendChild(kidsWrap);

  node.el=wrap; node.childrenEl=kidsWrap; node.labelEl=label;

  if(hasKids){ node.children.forEach(ch=> kidsWrap.appendChild(renderNode(ch))); }

  // Initial layout + aria-expanded finalization
  const openState=!!node.expanded; if(openState){ kidsWrap.style.maxHeight=kidsWrap.scrollHeight+'px'; kidsWrap.style.opacity='1'; kidsWrap.style.transform='translateY(0)'; }
  else{ kidsWrap.style.maxHeight='0px'; kidsWrap.style.opacity='0'; kidsWrap.style.transform='translateY(-2px)'; }
  label.setAttribute('aria-expanded', String(openState));

  if(hasKids){
    chev.addEventListener('click', (e)=>{ e.stopPropagation(); toggle(node,true); label.focus(); });
  }
  // Hover preview tooltip
  label.addEventListener('mouseenter', (e)=> showTooltip(node,e));
  label.addEventListener('mousemove', (e)=> positionTooltip(e));
  label.addEventListener('mouseleave', hideTooltip);

  // Click selection + micro feedback
  label.addEventListener('click', ()=>{ select(node); if(hasKids) open(node,true); pulse(label); });

  // Keyboard focusability handled by roving tabindex
  return wrap;
}

function pulse(el){ el.style.transform='translateY(-1px) scale(1.01)'; setTimeout(()=> el.style.transform='', 120); }

function select(node){ current=node; document.querySelectorAll('.label.active').forEach(el=> el.classList.remove('active')); if(node && node.el){ node.labelEl.classList.add('active'); node.labelEl.setAttribute('aria-selected','true'); }
  renderPanel(node); saveState(); announce(displayName(node.name)+ ' ì„ íƒë¨'); }

function open(node,announceIt){ node.expanded=true; const el=node.childrenEl; if(!el) return; el.classList.add('collapsing'); el.style.maxHeight=el.scrollHeight+'px'; el.style.opacity='1'; el.style.transform='translateY(0)'; const c=node.el.querySelector('.chev'); if(c) c.textContent='â–¾'; node.labelEl.setAttribute('aria-expanded','true'); setTimeout(()=> el.classList.remove('collapsing'), 240); if(announceIt) announce(displayName(node.name)+' í¼ì¹¨'); saveState(); }
function close(node,announceIt){ node.expanded=false; const el=node.childrenEl; if(!el) return; el.classList.add('collapsing'); el.style.maxHeight='0px'; el.style.opacity='0'; el.style.transform='translateY(-2px)'; const c=node.el.querySelector('.chev'); if(c) c.textContent='â–¸'; node.labelEl.setAttribute('aria-expanded','false'); setTimeout(()=> el.classList.remove('collapsing'), 240); if(announceIt) announce(displayName(node.name)+' ì ‘í˜'); saveState(); }
function toggle(node,announceIt){ node.expanded? close(node,announceIt) : open(node,announceIt); }

function renderTree(){ treeEl.innerHTML=''; treeEl.appendChild(renderNode(model)); initializeRovingTabindex(); }

function renderPanel(node){
  showLoading(120);
  if(!node){ panelEl.innerHTML='<h2>ë…¸ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</h2><p class="muted">ì¢Œì¸¡ íŠ¸ë¦¬ì—ì„œ í•­ëª©ì„ í´ë¦­í•˜ë©´ ìš”ì•½ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>'; return; }
  const title=displayName(node.name); const cat=categoryOf(node);
  const themeColor = {Root:'--root',ML:'--ml',DL:'--dl',Apps:'--apps',Models:'--models',Other:'--other'}[cat]||'--other';
  let html=`<h2 style="border-left:4px solid var(${themeColor});padding-left:8px;">${iconFor(node)} ${title} <span class='chip'>${cat}</span></h2>`;
  if(node.details){ const d=node.details; if(d.features?.length){ html += `<h3>ì£¼ìš” íŠ¹ì§•</h3><ul>${d.features.map(x=>`<li>${x}</li>`).join('')}</ul>`; } if(d.pros?.length){ html += `<h3>ì¥ì </h3><ul>${d.pros.map(x=>`<li>${x}</li>`).join('')}</ul>`; } if(d.cons?.length){ html += `<h3>ë‹¨ì  / ìœ ì˜ì </h3><ul>${d.cons.map(x=>`<li>${x}</li>`).join('')}</ul>`; } if(d.uses?.length){ html += `<h3>ì£¼ìš” í™œìš©</h3><ul>${d.uses.map(x=>`<li>${x}</li>`).join('')}</ul>`; } if(d.prompt){ html += `<h3>ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸</h3><div class="muted">${d.prompt}</div>`; } }
  else if(node.info){ html += `<p class='muted'>${node.info}</p>`; } else { html += `<div class='empty'>ìš”ì•½ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`; }

  // Info density: badge row + meters if metrics exist
  if(node.metrics || node.details?.metrics){ const m = node.metrics || node.details.metrics; const pop = Math.round((m.popularity||0)*100); const mat = Math.round((m.maturity||0)*100); html += `<div class='metaRow'>
      <div><div style='display:flex;justify-content:space-between'><span class='chip'>Popularity</span><span class='chip'>${pop}%</span></div><div class='meter'><i style='width:${pop}%'></i></div></div>
      <div><div style='display:flex;justify-content:space-between'><span class='chip'>Maturity</span><span class='chip'>${mat}%</span></div><div class='meter'><i style='width:${mat}%'></i></div></div>
    </div>`; }

  // DL examples
  if(categoryOf(node)==='DL'){ const ex = dlExamplesFor(node); if(ex.length){ html += `<h3>ì˜ˆì‹œ ì´ë¯¸ì§€</h3><div class='examples'>`+ ex.map(e=>`<div class='excard'><img alt='example' src='${e.src}'/><div class='cap'>${e.cap}</div></div>`).join('') + `</div>`; } }
  panelEl.innerHTML=html;
}

// Tooltip helpers
function showTooltip(node,evt){ tooltipTitle.textContent=displayName(node.name); tooltipDesc.textContent=node.info || 'ìƒì„¸ ì •ë³´ë¥¼ ë³´ë ¤ë©´ Enter/í´ë¦­'; tooltip.style.opacity='1'; tooltip.style.transform='translateY(0)'; tooltip.setAttribute('aria-hidden','false'); positionTooltip(evt); }
function positionTooltip(evt){ const pad=14; const x=Math.min(window.innerWidth-360-pad, evt.clientX+12); const y=Math.min(window.innerHeight-80, evt.clientY+12); tooltip.style.left=x+'px'; tooltip.style.top=y+'px'; }
function hideTooltip(){ tooltip.style.opacity='0'; tooltip.style.transform='translateY(6px)'; tooltip.setAttribute('aria-hidden','true'); }

// Loading indicator (debounced)
let loadingTimer=null; function showLoading(delay=120){ clearTimeout(loadingTimer); loadingEl.style.display='flex'; loadingTimer=setTimeout(()=> loadingEl.style.display='none', delay); }

// Search
const q=document.getElementById('q'); const clearBtn=document.getElementById('clear');
function searchTree(){ const term=(q.value||'').trim().toLowerCase(); document.querySelectorAll('.node').forEach(n=> n.classList.remove('match','dim')); if(!term){ announce('ê²€ìƒ‰ ë¹„ì›€'); return; }
  function dfs(node){ const me=node.name.toLowerCase().includes(term); let childHit=false; (node.children||[]).forEach(c=>{ if(dfs(c)) childHit=true; }); const hit=me||childHit; if(hit){ open(node); if(node.el) node.el.classList.add('match'); } else if(node.el) node.el.classList.add('dim'); return hit; }
  showLoading(250); dfs(model); announce('ê²€ìƒ‰ ê²°ê³¼ ê°•ì¡°ë¨'); }
q.addEventListener('input', searchTree);
clearBtn.addEventListener('click', ()=>{ q.value=''; searchTree(); q.focus(); });

// Keyboard accessibility (roving tabindex + tree navigation)
function visibleNodes(){ return Array.from(treeEl.querySelectorAll('.label')).map(el=> findNodeByEl(el.closest('.node'))).filter(Boolean); }
function initializeRovingTabindex(){ const nodes=visibleNodes(); nodes.forEach(elNode=> elNode.labelEl.setAttribute('tabindex','-1')); focusNode = current || model; focusNode.labelEl.setAttribute('tabindex','0'); }
function moveFocusTo(node){ if(!node || !node.labelEl) return; if(focusNode && focusNode.labelEl) focusNode.labelEl.setAttribute('tabindex','-1'); node.labelEl.setAttribute('tabindex','0'); node.labelEl.focus(); focusNode=node; }

// Map element back to node
function findNodeByEl(el,node=model){ if(node.el===el) return node; for(const c of (node.children||[])){ const x=findNodeByEl(el,c); if(x) return x; } return null; }

// Key handling
treeEl.addEventListener('keydown', (e)=>{
  const key=e.key; const target=e.target; if(!target.classList.contains('label')) return;
  const node=findNodeByEl(target.closest('.node'));
  if(key==='Enter' || key===' '){ e.preventDefault(); select(node); if(node.children?.length) open(node,true); return; }
  if(key==='ArrowRight'){ e.preventDefault(); if(node.children?.length && !node.expanded) open(node,true); else if(node.children?.length){ moveFocusTo(node.children[0]); }
    return; }
  if(key==='ArrowLeft'){ e.preventDefault(); if(node.expanded){ close(node,true); } else if(node.parentRef){ moveFocusTo(node.parentRef); } return; }
  if(key==='ArrowDown' || key==='ArrowUp'){ e.preventDefault(); const list=visibleNodes(); const idx=list.indexOf(node); const next = (key==='ArrowDown') ? list[Math.min(idx+1, list.length-1)] : list[Math.max(idx-1,0)]; if(next) moveFocusTo(next); return; }
  if(key==='Home'){ e.preventDefault(); const first=visibleNodes()[0]; if(first) moveFocusTo(first); return; }
  if(key==='End'){ e.preventDefault(); const list=visibleNodes(); const last=list[list.length-1]; if(last) moveFocusTo(last); return; }
});

// Global keys: Esc to clear search
window.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ if(q===document.activeElement && q.value){ q.value=''; searchTree(); announce('ê²€ìƒ‰ ì´ˆê¸°í™”'); } } });

// Expand / Collapse / Lang
function expandAll(node=model){ open(node); (node.children||[]).forEach(expandAll); saveState(); }
function collapseAllFn(node=model){ if(node!==model) close(node); (node.children||[]).forEach(collapseAllFn); saveState(); }

document.getElementById('expandAll').onclick=()=> expandAll();
document.getElementById('collapseAll').onclick=()=> collapseAllFn();
document.getElementById('toggleLang').onclick=()=>{ lang=(lang==='ko'?'en':'ko'); document.querySelectorAll('.node .label .txt').forEach((el)=>{ const node=findNodeByEl(el.closest('.node')); if(node) el.textContent=displayName(node.name); }); renderPanel(current); saveState(); announce('ì–¸ì–´ ì „í™˜'); };

// ===== State persistence =====
const STATE_KEY='aimap_accessible_state_v1';
function nodePath(node){ const parts=[]; let n=node; while(n){ parts.push(n.name); n=n.parentRef; } return parts.reverse().join(' > '); }
function findByPath(path){ const parts=path.split(' > '); if(parts[0]!==model.name) return null; let n=model; for(let i=1;i<parts.length;i++){ n=(n.children||[]).find(c=>c.name===parts[i]); if(!n) return null; } return n; }
function collectExpanded(node=model,out=[]){ if(node.expanded) out.push(nodePath(node)); (node.children||[]).forEach(c=>collectExpanded(c,out)); return out; }
function expandByPaths(paths=[]){ paths.forEach(p=>{ const n=findByPath(p); if(n){ let cur=n; while(cur){ cur.expanded=true; if(cur.childrenEl){ cur.childrenEl.style.maxHeight=cur.childrenEl.scrollHeight+'px'; cur.childrenEl.style.opacity='1'; cur.childrenEl.style.transform='translateY(0)'; } cur=cur.parentRef; } }}); }
function saveState(){ try{ const st={ lang, selected: current? nodePath(current): null, expanded: collectExpanded() }; localStorage.setItem(STATE_KEY, JSON.stringify(st)); }catch(e){} }
function restoreState(){ try{ const raw=localStorage.getItem(STATE_KEY); if(!raw) return; const st=JSON.parse(raw); if(st.lang && st.lang!==lang){ lang=st.lang; } expandByPaths(st.expanded||[]); document.querySelectorAll('.node .label .txt').forEach((el)=>{ const node=findNodeByEl(el.closest('.node')); if(node) el.textContent=displayName(node.name); }); if(st.selected){ const n=findByPath(st.selected); if(n){ select(n); moveFocusTo(n); }} }catch(e){} }

// Initial render
renderTree();
renderPanel(null);
restoreState();
initializeRovingTabindex();

// ===== Tests (console) =====
(function runTests(){
  const results=[]; function test(name,fn){ try{ fn(); results.push({name,ok:true}); } catch(e){ console.error('[TEST FAIL]',name,e); results.push({name,ok:false,err:e}); } }
  // (1) Existing tests â€” keep unchanged
  test('ARIA roles present',()=>{ if(treeEl.getAttribute('role')!=='tree') throw 0; const any=document.querySelector('[role="treeitem"]'); if(!any) throw 0; });
  test('Roving tabindex single 0',()=>{ const labs=[...document.querySelectorAll('.label')]; const zeros=labs.filter(l=> l.tabIndex===0); if(zeros.length!==1) throw new Error('tabindex 0 count='+zeros.length); });
  test('Contrast colors exist',()=>{ const style=getComputedStyle(document.documentElement); ['--ml','--dl','--apps','--models','--root'].forEach(v=>{ if(!style.getPropertyValue(v)) throw new Error('missing '+v); }); });
  test('Keyboard map attached',()=>{ const h=(getEventListeners? getEventListeners(treeEl).keydown: null); /* optional */ });

  // (2) Additional tests â€” do not modify existing ones
  test('At least one group element under tree',()=>{ const grp=document.querySelector('[role="group"]'); if(!grp) throw new Error('no role=group'); });
  test('Nodes with children have aria-expanded',()=>{ const items=[...document.querySelectorAll('[role="treeitem"]')]; const withKids=items.filter(el=> el.parentElement?.nextSibling); /* crude heuristic */ items.forEach(el=>{ if(el.getAttribute('aria-expanded')==null) throw new Error('missing aria-expanded'); }); });
  test('Live region exists',()=>{ const live=document.getElementById('sr-live'); if(!live || live.getAttribute('aria-live')!=='polite') throw new Error('aria-live missing'); });

  const ok=results.filter(r=>r.ok).length; const fail=results.length-ok; if(fail===0) console.log('%cAll tests passed ('+ok+')','color:#22c55e'); else console.warn('Tests: ',{ok,fail,results});
})();
</script>
</body>
</html>
